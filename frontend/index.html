<!doctype html>
<html lang="es">

<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>ASK MY DOCS - 1.0</title>
    <style>
        body {
            font-family: system-ui, sans-serif;
            max-width: 800px;
            margin: 40px auto;
            line-height: 1.5;
        }

        .card {
            border: 1px solid #ddd;
            border-radius: 12px;
            padding: 16px;
            margin-bottom: 20px;
        }

        button {
            padding: 10px 16px;
            border-radius: 8px;
            border: 1px solid #ccc;
            cursor: pointer;
        }

        input[type="file"] {
            margin: 10px 0;
        }

        code {
            background: #f6f6f6;
            padding: 2px 6px;
            border-radius: 6px;
        }
    </style>
</head>

<body>
    <h1>ASK MY DOCS - 1.0</h1>

    <div class="card">
        <h2>1) Subir PDF a S3</h2>
        <p>Elegí un PDF y lo subimos directo a S3 con un <em>pre-signed URL</em>.</p>
        <input id="fileInput" type="file" accept="application/pdf" />
        <div>
            <label>API Base URL:</label>
            <input id="apiBase" size="60" placeholder="https://dyyy3sy3r3.execute-api.us-east-1.amazonaws.com" />
        </div>
        <button id="btnUpload">Subir PDF</button>
        <p id="uploadStatus"></p>
        <p>Key del archivo: <code id="fileKey">–</code></p>
    </div>

    <div class="card">
        <h2>2) Preguntar sobre el PDF</h2>
        <p>Una vez procesado, podrás hacer preguntas. (Activamos esto en la próxima lección.)</p>
        <label>Key (del PDF o del texto):</label>
        <input id="askKey" size="60" placeholder="uploads/xxxxx.pdf" />
        <br /><br />
        <label>Pregunta:</label><br />
        <textarea id="question" rows="3" cols="70" placeholder="¿De qué trata el documento?"></textarea>
        <br /><br />
        <button id="btnAsk" disabled>Preguntar (próxima lección)</button>
        <pre id="answer"></pre>
    </div>

    <script>
        const fileInput = document.getElementById('fileInput');
        const apiBase = document.getElementById('apiBase');
        const uploadStatus = document.getElementById('uploadStatus');
        const fileKeyEl = document.getElementById('fileKey');
        const askKey = document.getElementById('askKey');

        document.getElementById('btnUpload').onclick = async () => {
            uploadStatus.textContent = '';
            const file = fileInput.files?.[0];
            const base = apiBase.value.trim();
            if (!file) { uploadStatus.textContent = 'Elegí un PDF primero.'; return; }
            if (!base) { uploadStatus.textContent = 'Pegá el API Base URL.'; return; }

            try {
                // 1) Pedimos URL firmada
                const urlRes = await fetch(`${base}/get-upload-url?ext=pdf`);
                const { uploadUrl, key } = await urlRes.json();

                // 2) Subimos directo a S3
                const putRes = await fetch(uploadUrl, {
                    method: 'PUT',
                    headers: { 'Content-Type': 'application/pdf' },
                    body: file
                });
                if (!putRes.ok) throw new Error('Fallo al subir a S3');

                uploadStatus.textContent = '¡Subido con éxito! Esperá el procesamiento.';
                fileKeyEl.textContent = key;
                askKey.value = key; // lo dejamos listo para la próxima fase
            } catch (e) {
                uploadStatus.textContent = 'Error: ' + e.message;
            }
        };
    </script>
</body>

</html>